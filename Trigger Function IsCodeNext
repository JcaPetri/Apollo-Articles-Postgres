DROP FUNCTION IF EXISTS public."IDCodeNext"();

CREATE OR REPLACE FUNCTION public."IDCodeNext"()
    RETURNS trigger
    LANGUAGE 'plpgsql'
    COST 100
    VOLATILE NOT LEAKPROOF
AS $BODY$
BEGIN
	IF NEW.IDCode NULL THEN 
	--  OR NEW.IDCode = 0 OR NEW.IDCode = ""
		SELECT COALESCE(MAX("IDCode"),0) + 1 FROM public."ArtTDataElement" WHERE "ScopeIDn" = new.ScopeIDn;
	END IF;
RETURN NEW;
END;
$BODY$;

ALTER FUNCTION public."IDCodeNext"()
    OWNER TO postgres;
